const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyohhuiukg4vIXKH-UiDu0JXCdvGxg0x9YVFiN_sOJJEZTJxpCODIGhGVqdU2J_YSxHsw/exec"; // your web app URL
let answerTimeout;

// Send question/answer
function logChoice(question, answer) {
  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({question: question, answer: answer})
  }).catch(err => console.error("Error logging choice:", err));
}

// Send status (Finished, Unfinished, Stopped)
function logStatus(status) {
  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({status: status})
  }).catch(err => console.error("Error logging status:", err));
}

// Start 15-second timer for unanswered question
function startAnswerTimer() {
  clearTimeout(answerTimeout);
  answerTimeout = setTimeout(() => {
    logStatus("Unfinished");
  }, 15000);
}

// Detect tab close early
window.addEventListener("beforeunload", function() {
  logStatus("Stopped answering");
});

// Show questions and handle answers
const quiz = [
    {
        question: "Hello Alliyah",
        answers: [
            { text: "Say hello", color: "green" }
        ]
    },
    {
        question: "Do you know I like you?",
        answers: [
            { text: "Yeahh", color: "green" },
            { text: "No?", color: "red" }
        ]
    },
    {
        question: "Now you know right lol",
        answers: [
            { text: "Yeahh lol", color: "green" },
            { text: "Yeah pretty obvious", color: "blue" }
        ]
    },
    {
        question: "Will I ever have a chance?",
        answers: [
            { text: "Yeah", color: "green" },
            { text: "No", color: "red" }
        ]
    },
    {
        question: "Are you uncomfortable of me admiring you, would you like me to stop?",
        answers: [
            { text: "Not really", color: "green" },
            { text: "Yeah stop", color: "red" }
        ]
    },
    {
        question: "Thank you for answering. Have a nice day!",
        answers: [
            { text: "You too", color: "green" },
            { text: "Alright bye", color: "blue" }
        ]
    }
];

let currentQuestion = 0;

function showQuestion(index) {
    startAnswerTimer(); // start 15-second timer for this question
    const q = quiz[index];
    document.getElementById("questionText").textContent = q.question;
    const btnContainer = document.getElementById("buttonsContainer");
    btnContainer.innerHTML = "";

    q.answers.forEach(answer => {
        const btn = document.createElement("button");
        btn.textContent = answer.text;
        btn.className = `button ${answer.color}`;
        btn.onclick = () => {
            clearTimeout(answerTimeout);
            logChoice(q.question, answer.text);

            if(index === quiz.length - 1) {
                logStatus("Finished"); // last question clicked
                document.body.innerHTML = `
                    <div class="container">
                        <h1 style="color:#d32f2f;">Thanks for answering, Alliyah ❤️</h1>
                        <div class="gif_container">
                            <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMmo3c3l5ODh3ZGN6NHhhaDE2Mjg1ZjkwOXczdDFxbWM3dTBtaW9zaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/9XY4f3FgFTT4QlaYqa/giphy.gif" alt="Ending GIF">
                        </div>
                    </div>
                `;
            } else {
                currentQuestion++;
                showQuestion(currentQuestion);
            }
        };
        btnContainer.appendChild(btn);
    });
}

showQuestion(currentQuestion);
